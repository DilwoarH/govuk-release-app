<% content_for :page_title, "Applications" %>

<h1>Applications</h1>

<table class="table table-striped table-bordered table-hover table-condensed">
  <thead>
    <tr>
      <th>Name</th>
      <th>In sync?</th>
      <% @environments.each do |environment| %>
        <th><%= environment.humanize %></th>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% @applications.each do |application| %>
      <tr>
        <td>
          <%= link_to application.name, application %>
        </td>
        <td class="<%= application.staging_and_production_in_sync? ? "in-sync" : "not-in-sync" %>">
          <%= application.staging_and_production_in_sync? ? "Yes" : "No" %>
        </td>
        <% @environments.each do |environment| %>
          <% latest_deploy = application.deployments.last_deploy_to(environment) %>
          <td class="<%= latest_deploy.try(:recent?) ? "deployed-recently" : "" %>">  
            <% if latest_deploy %>
              <%= github_tag_link_to(application.repo, latest_deploy.version) %> 
              <span class="muted">
                at
                <%= human_datetime(latest_deploy.created_at) %>
              </span>
            <% else %>
              N/A
            <% end %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<%= link_to 'Create Application', new_application_path, class: "btn btn-success" %>
