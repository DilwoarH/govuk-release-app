<% content_for :page_title, "Applications" %>

<h1>Applications</h1>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Name</th>
      <th>Repo</th>
      <% @environments.each do |environment| %>
        <th><%= environment.humanize %></th>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% @applications.each do |application| %>
      <tr>
        <td><%= link_to application.name, application %></td>
        <td><%= link_to application.repo, "https://github.com/#{application.repo}" %></td>
        <% @environments.each do |environment| %>
          <td>
            <% latest_deploy = application.deployments.last_deploy_to(environment) %>
            <% if latest_deploy %>
              <%= latest_deploy.version %>
              <small><%= github_tag_link_to(application.repo, latest_deploy.version) %></small>
              <br>
              <%= human_datetime(latest_deploy.created_at) %>
            <% else %>
              N/A
            <% end %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<%= link_to 'Create Application', new_application_path, class: "btn btn-success" %>
